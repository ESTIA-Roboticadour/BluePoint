# BluePoint

**BluePoint ToolKit** is a C++ solution developed with Visual Studio, Qt 6, OpenCV, and the Pylon SDK.  
It contains all the components and tools for the BluePoint project, including Qt Designer plugins, libraries, and applications.

## üì¶ Projects

Some projects are shared libraries and Qt Designer plugins. They **must be compiled first** using Qt Creator.  
They provide reusable widgets and logic that are dynamically loaded by other applications.

### üîß Qt Creator Projects (Plugins & Libraries)

- `FrameViewer`: Widget to display an image. Display as large as possible on a customisable background, keeping the aspect ratio.
- `NavigationWidgets`: Widgets for navigation. Navigation is done through a tree of nodes.
- `ParametersCustomWidgets`: Builds dynamic UI widgets to control various parameter types (numbers, booleans, strings...).
- `TogglePanel`: A widget for an openable and closeable panel. Ideal for sidebar menus.

  üëâ **Required to be compiled**, as it provides headers, `.lib` and `.dll` files used by other projects.

A helper script is provided to **prepare and install these libraries** correctly (see `Setup section`).

### üñ•Ô∏è Visual Studio Projects

These are the main applications of the BluePoint project:

- `CameraHeight` ‚Äî Estimates the height of a camera.
- `CameraAcquisition` ‚Äî Opens and records video streams from a laptop webcam or Basler camera.
- `Vision` ‚Äî Handles the computer vision logic for the BluePoint robotic system.

---

## ‚öôÔ∏è General Setup

All projects rely on the following libraries. Make sure they are correctly installed and configured.

### ‚úÖ Requirements

- **Qt** ‚Äì [We use Qt 6.8.2](https://www.qt.io/download-dev)
- **OpenCV** ‚Äì [We use OpenCV 4.11.0](https://opencv.org/releases/)
- **Pylon SDK** ‚Äì [We use Pylon 8.1.0](https://www.baslerweb.com/en/downloads/software/?downloadCategory.values.label.data=pylon)

### üß∞ Setup Instructions

1. **Clone the repository**:
```bash
git clone https://github.com/ESTIA-Roboticadour/BluePoint
```

2. Install `OpenCV`:
- Download from: https://opencv.org/releases/
- Extract and set system PATH to include:
```
C:\opencv\build\x64\vc16\bin
C:\opencv\build\x64\vc16\lib
```
- Restart your computer if needed.

3. Install `Qt`
- Download `Qt 6.8.2` from: https://www.qt.io/download-dev.
- Install `Qt Visual Studio Tools` (from the Visual Studio extension manager).
- Set the appropriate Qt Kit in Qt Creator to compile Qt-based libraries.

4. Install `Balser Pylon SDK`
- Download and install from: https://www.baslerweb.com/en/downloads/software/?downloadCategory.values.label.data=pylon
- This includes `Pylon Viewer` and the `SDK`.
- Make sure the `pylon` `bin` and `lib` folders are in your `PATH`.
- Restart your computer if needed.
- We recommend you to test your camera with `Pylon Viewer`. Make sure you have plugged your camera into a **USB 3 port**. 

---

## üèóÔ∏è Building Projects

To build the project, you first need to setup all plugins and shared librairies. To do that, there is 2 ways.
- 1) Use the `installer.sh` script to do everything automatically.
- 2) Do it manually.

After the setup done, the project structure would be as bellow:

```
BluePoint/
‚îú‚îÄ‚îÄ Plugins/                          # Qt Designer plugins and shared libraries
‚îÇ   ‚îú‚îÄ‚îÄ ParametersWidgets/
‚îÇ   ‚îú‚îÄ‚îÄ other plugins to compile ...
|   ...
‚îú‚îÄ‚îÄ CameraAcquisition/                # Visual Studio app: capture and record video
‚îú‚îÄ‚îÄ Vision/                           # Visual Studio app: computer vision logic
‚îú‚îÄ‚îÄ other projects...
‚îú‚îÄ‚îÄ Libraries/                        # Auto-generated by setup script
‚îÇ   ‚îú‚îÄ‚îÄ ParametersWidgets/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ include/                  # Headers copied from shared libs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib/                      # .lib files for linking
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ bin/                      # .dll files for runtime
‚îÇ   ‚îú‚îÄ‚îÄ other librairies...
|   ...
‚îú‚îÄ‚îÄ x64/                              # Auto-generated by setup script (and by Visual Studio)
‚îÇ   ‚îú‚îÄ‚îÄ Debug/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ParametersWidgetsd.dll
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ other debug dll...
‚îÇ   ‚îú‚îÄ‚îÄ Release/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ParametersWidgets.dll
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ other release dll...
‚îú‚îÄ‚îÄ scripts/                          # Scripts folder
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ installer.sh              # Script to setup shared libs
‚îú‚îÄ‚îÄ installer.sh.lnk                  # Link to use to execute the script: scripts/installer.sh
‚îî‚îÄ‚îÄ README.md                         # This file
```

### ü™Ñ installer.sh

#### ‚öôÔ∏è Configuration

Open the script `scripts/installer.sh` in a text editor, then edit / check the configurations paths (in the editable section).

Default values are:
```bash
$QMAKE_EXE = "C:\Qt\6.8.2\msvc2022_64\bin\qmake.exe"
$MAKE_EXE = "C:\Qt\Tools\QtCreator\bin\jom\jom.exe"
$QT_DESIGNER_PLUGIN_DIR = "C:\Qt\Tools\QtCreator\bin\plugins\designer\"
```

You still have to select a `qmake.exe` from an `msvc` compiler.

#### ‚ñ∂Ô∏è Run

Run the script `installer-plugins.sh.lnk` (the link).
```bash
./installer-plugins.sh.lnk
```

This script will:
- **Compile** all plugin projects (from `Plugins` folder) in `debug` and `release`.
- **Install** the plugins for Qt Designer.
- **Create** the `Librairies` folder for shared librairies. It will also create folders for each plugin, and `bin`, `lib` and `include` subfolders for each of them. These subfolders will be feed with `.h`, `.lib` and `.dll` files.
- **Create** the `x64\Debug` and `x64\Release` folders and copy `debug` and `release` `dll` files.

Then you can open the `.sln` solution and compile project you want. See `üß± Build Visual Studio Applications` section.

### üîå Manual install
For each polugin project contained in `Plugin` folder, you have to:
- Compile them in Qt Creator.
- Copy `.h`, `.lib` and `.dll` files to right destinations.

For all projects in `Plugins` folder:
1. Open a project in folder in **Qt Creator**.
2. Create the config. You need to select `msvc2022_64` compilator. Then check the compiler steps. By default you have **2 steps** for both configuration `debug` and `release`. You need to add an additional step for `release`: add a `Make` step, with `install` as argument.
3. Compile the project in `Debug` then in `Release` to generate debug and release `.lib` and `.dll` files.
4. Copy `.dll` (release only) to you designer plugin folder (e.g.: `C:\Qt\Tools\QtCreator\bin\plugins\designer`).
5. Create folder `Librairies` and project subfolder, and `include`, `lib` and `bin` folders ‚Üí **Create the structure showed above**.
6. Copy `debug` and `release` `.lib` generated files and past into `lib` folder.
7. Copy `debug` and `release` `.dll` generated files and past into `bin` folder. Copy them into `x64/Debug` and `x64/Release` folders as well.
8. Copy `.h` files into `include`. You don't have to copy header file that ends with `Plugin.h`. 

### üß± Build Visual Studio Applications

1. Open the `.sln` file in **Visual Studio**.
2. Make sure the `Libraries/` folder is properly filled (see).
3. For each project, check the following in **Configuration Properties**:
   - `C/C++ > General > Additional Include Directories` (should be okay)
   - `Linker > General > Additional Library Directories` (should be okay)
   - `Linker > Input > Additional Dependencies`  
     ‚ö†Ô∏è Make sure to use the correct `.lib` files depending on your versions of extern libraires (OpenCV, Pylon, etc.) for both configuration (**Debug** or **Release**).
     E.g.: With `OpenCV 4.11.0`, used lib is `opencv_world4110d.lib` for `Debug` and `opencv_world4110.lib` for `Release`. It could change if you use another version.
4. Build and run the application.

### üöÄ Qt Deployment

Once you have compiled the Visual Studio projects you want (**Release compilation more specifically**, Debug compilation is not necessarily mandatory), you can run the script `installer-qtdeploy.ps1.lnk` to easily deploy the Qt libraries and have an application ready to deploy.

#### üìå Notes

- See each project's `README.md` for specific usage and build instructions.

## ‚ùì FAQ
**Q: I get missing .lib or .dll errors when building in Visual Studio.**
A: If the missing file is related to our librairies, run `installer.sh`. If not, check the configuration of your project (include directories, lib directories, input lib).

**Q: My Basler camera is not readable.**
A: Ensure you plugged it on the **USB 3 port**. You can also install `Pylon Viewer` (if it's not already done) to test your camera.

**Q: How do I debug Qt UIs in Visual Studio?**
A: Use `Qt Visual Studio Tools` to integrate Qt Designer, or test the UI in Qt Creator first.
